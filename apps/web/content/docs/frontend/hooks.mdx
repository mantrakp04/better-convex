---
title: Custom Hooks
description: Building reusable hooks for Convex data
---

# Custom Hooks

Custom hooks encapsulate data fetching logic, making components cleaner and logic reusable.

## Query Hooks

### Basic Query Hook

```tsx
// hooks/useTodoStats.ts
import { useConvexQuery } from "@convex-dev/react-query";
import { api } from "@/convex/_generated/api";

export function useTodoStats() {
  const { data, isLoading, error } = useConvexQuery(
    api.todos.stats.getOrgStats,
    {}
  );

  return {
    stats: data,
    isLoading,
    error,
  };
}
```

### Paginated Query Hook

```tsx
// hooks/useTodosList.ts
import { useConvexPaginatedQuery } from "@convex-dev/react-query";
import { api } from "@/convex/_generated/api";

export interface TodoFilters {
  status?: "todo" | "in_progress" | "done";
  priority?: "low" | "medium" | "high";
  teamId?: string;
  search?: string;
}

export function useTodosList(filters: TodoFilters = {}) {
  const query = useConvexPaginatedQuery(
    api.todos.list,
    { filters },
    { initialNumItems: 20 }
  );

  return {
    todos: query.results,
    isLoading: query.status === "LoadingFirstPage",
    isLoadingMore: query.status === "LoadingMore",
    hasMore: query.status === "CanLoadMore",
    loadMore: () => query.loadMore(20),
  };
}
```

### Conditional Query Hook

```tsx
// hooks/useTodo.ts
import { useConvexQuery } from "@convex-dev/react-query";
import { api } from "@/convex/_generated/api";

export function useTodo(id: string | null) {
  const { data, isLoading } = useConvexQuery(
    api.todos.getById,
    id ? { id } : "skip"
  );

  return {
    todo: data,
    isLoading: id ? isLoading : false,
  };
}
```

## Mutation Hooks

### Single Mutation Hook

```tsx
// hooks/useCreateTodo.ts
import { useConvexMutation } from "@convex-dev/react-query";
import { useMutation } from "@tanstack/react-query";
import { api } from "@/convex/_generated/api";
import { toast } from "sonner";

export function useCreateTodo() {
  const createFn = useConvexMutation(api.todos.create);

  return useMutation({
    mutationFn: createFn,
    onSuccess: () => {
      toast.success("Todo created successfully");
    },
    onError: (error) => {
      toast.error(`Failed to create todo: ${error.message}`);
    },
  });
}
```

### Combined Mutations Hook

```tsx
// hooks/useTodoMutations.ts
import { useConvexMutation } from "@convex-dev/react-query";
import { useMutation } from "@tanstack/react-query";
import { api } from "@/convex/_generated/api";
import { toast } from "sonner";

export function useTodoMutations() {
  const createFn = useConvexMutation(api.todos.create);
  const updateFn = useConvexMutation(api.todos.update);
  const deleteFn = useConvexMutation(api.todos.remove);
  const assignFn = useConvexMutation(api.todos.assignUsers);

  const create = useMutation({
    mutationFn: createFn,
    onSuccess: () => toast.success("Todo created"),
    onError: (e) => toast.error(`Create failed: ${e.message}`),
  });

  const update = useMutation({
    mutationFn: updateFn,
    onSuccess: () => toast.success("Todo updated"),
    onError: (e) => toast.error(`Update failed: ${e.message}`),
  });

  const remove = useMutation({
    mutationFn: deleteFn,
    onSuccess: () => toast.success("Todo deleted"),
    onError: (e) => toast.error(`Delete failed: ${e.message}`),
  });

  const assign = useMutation({
    mutationFn: assignFn,
    onSuccess: (_, variables) =>
      toast.success(`Assigned ${variables.userIds.length} users`),
    onError: (e) => toast.error(`Assignment failed: ${e.message}`),
  });

  return { create, update, remove, assign };
}
```

## Specialized Hooks

### Status Update Hook

```tsx
// hooks/useTodoStatus.ts
import { useConvexMutation } from "@convex-dev/react-query";
import { useMutation } from "@tanstack/react-query";
import { api } from "@/convex/_generated/api";

type Status = "todo" | "in_progress" | "done";

export function useTodoStatus(todoId: string) {
  const updateFn = useConvexMutation(api.todos.update);

  const mutation = useMutation({
    mutationFn: (status: Status) => updateFn({ id: todoId, status }),
  });

  return {
    setStatus: mutation.mutate,
    isPending: mutation.isPending,
    markTodo: () => mutation.mutate("todo"),
    markInProgress: () => mutation.mutate("in_progress"),
    markDone: () => mutation.mutate("done"),
  };
}
```

### Kanban Drag Hook

```tsx
// hooks/useKanbanDrag.ts
import { useTodoMutations } from "./useTodoMutations";

export function useKanbanDrag() {
  const { update } = useTodoMutations();

  const onDragEnd = (result: DropResult) => {
    if (!result.destination) return;

    const todoId = result.draggableId;
    const newStatus = result.destination.droppableId as Status;

    update.mutate({ id: todoId, status: newStatus });
  };

  return { onDragEnd, isUpdating: update.isPending };
}
```

## Auth Hooks

### Current User Hook

```tsx
// hooks/useCurrentUser.ts
import { useSession } from "@/lib/auth";

export function useCurrentUser() {
  const { data: session, isPending } = useSession();

  return {
    user: session?.user ?? null,
    isLoading: isPending,
    isAuthenticated: !!session,
    organizationId: session?.session.activeOrganizationId,
    teamId: session?.session.activeTeamId,
    role: session?.session.organizationRole,
  };
}
```

### Permission Hook

```tsx
// hooks/usePermissions.ts
import { useCurrentUser } from "./useCurrentUser";

export function usePermissions() {
  const { role, user } = useCurrentUser();

  const isOwner = role === "owner";
  const isAdmin = role === "admin" || isOwner;
  const isMember = !!role;

  const canManageMembers = isAdmin;
  const canDeleteOrg = isOwner;
  const canEditSettings = isAdmin;

  const canEditResource = (resourceUserId: string) => {
    return isAdmin || resourceUserId === user?.id;
  };

  return {
    isOwner,
    isAdmin,
    isMember,
    canManageMembers,
    canDeleteOrg,
    canEditSettings,
    canEditResource,
  };
}
```

## Hook Composition

### Combined Data Hook

```tsx
// hooks/useDashboard.ts
import { useTodoStats } from "./useTodoStats";
import { useTodosList } from "./useTodosList";
import { useCurrentUser } from "./useCurrentUser";

export function useDashboard() {
  const user = useCurrentUser();
  const stats = useTodoStats();
  const recentTodos = useTodosList({ limit: 5 });

  const isLoading = user.isLoading || stats.isLoading || recentTodos.isLoading;

  return {
    user: user.user,
    stats: stats.stats,
    recentTodos: recentTodos.todos,
    isLoading,
  };
}
```

## Usage Examples

```tsx
// components/TodoList.tsx
function TodoList() {
  const { todos, isLoading, hasMore, loadMore } = useTodosList();
  const { update, remove } = useTodoMutations();
  const { canEditResource } = usePermissions();

  if (isLoading) return <Loading />;

  return (
    <div>
      {todos.map((todo) => (
        <TodoItem
          key={todo._id}
          todo={todo}
          canEdit={canEditResource(todo.userId)}
          onUpdate={(data) => update.mutate({ id: todo._id, ...data })}
          onDelete={() => remove.mutate({ id: todo._id })}
        />
      ))}

      {hasMore && <button onClick={loadMore}>Load More</button>}
    </div>
  );
}
```

Next, learn about [Optimistic Updates](/docs/frontend/optimistic-updates).
